<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SawitPRO - TokoSawit Product Recommendations</title>
    <!-- Link to external CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <!-- Header -->
    <header>
        <nav>
            <a href="#" class="logo">
                <div class="logo-icon">üå±</div>
                SawitPRO
            </a>
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="#api-demo">API Demo</a></li>
                <li><a href="#products">Products</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="hero-content">
            <h1>TokoSawit Product Recommendations</h1>
            <p>AI-powered recommendation system for palm oil plantation supplies and expert agricultural guidance</p>
            <a href="#api-demo" class="cta-button">Try API Demo</a>
        </div>
    </section>

    <!-- API Demo Section -->
    <section class="api-demo" id="api-demo">
        <div class="container">
            <h2 class="section-title">Recommendation API Demo</h2>
            <div class="api-grid">
                <!-- User Recommendations -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        User Recommendations
                    </h3>
                    <p class="api-description">Get personalized product recommendations for a specific user based on their plantation data and purchase history.</p>
                    <div class="api-form">
                        <div class="form-group">
                            <label for="userId">User ID:</label>
                            <input type="text" id="userId" placeholder="Enter user ID" value="user_001">
                        </div>
                        <button class="api-button" onclick="getUserRecommendations()">Get Recommendations</button>
                        <div id="userRecommendationsResponse" class="api-response" style="display: none;"></div>
                    </div>
                </div>

                <!-- Similar Products -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        Similar Products
                    </h3>
                    <p class="api-description">Find products similar to a specified product based on attributes and usage patterns.</p>
                    <div class="api-form">
                        <div class="form-group">
                            <label for="productId">Product ID:</label>
                            <input type="text" id="productId" placeholder="Enter product ID" value="prod_001">
                        </div>
                        <button class="api-button" onclick="getSimilarProducts()">Find Similar Products</button>
                        <div id="similarProductsResponse" class="api-response" style="display: none;"></div>
                    </div>
                </div>

                <!-- Feedback Submission -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-post">POST</span>
                        Submit Feedback
                    </h3>
                    <p class="api-description">Submit feedback on recommendations to improve the algorithm over time.</p>
                    <div class="api-form">
                        <div class="form-group">
                            <label for="feedbackUserId">User ID:</label>
                            <input type="text" id="feedbackUserId" placeholder="Enter user ID" value="user_001">
                        </div>
                        <div class="form-group">
                            <label for="feedbackProductId">Product ID:</label>
                            <input type="text" id="feedbackProductId" placeholder="Enter product ID" value="prod_001">
                        </div>
                        <div class="form-group">
                            <label for="feedbackAction">Action:</label>
                            <input type="text" id="feedbackAction" placeholder="clicked, purchased, viewed" value="clicked">
                        </div>
                        <button class="api-button" onclick="submitFeedback()">Submit Feedback</button>
                        <div id="feedbackResponse" class="api-response" style="display: none;"></div>
                    </div>
                </div>

                <!-- Chatbot API -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-post">POST</span>
                        Chatbot Message
                    </h3>
                    <p class="api-description">Send a message to the AI chatbot for agricultural advice and product recommendations.</p>
                    <div class="api-form">
                        <div class="form-group">
                            <label for="chatMessage">Message:</label>
                            <textarea id="chatMessage" rows="3" placeholder="Ask about palm plantation best practices or product recommendations">What fertilizers do you recommend for 5-year-old palm trees?</textarea>
                        </div>
                        <button class="api-button" onclick="sendChatbotMessage()">Send Message</button>
                        <div id="chatbotResponse" class="api-response" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products" id="products">
        <div class="container">
            <h2 class="section-title">TokoSawit Product Categories</h2>
            <div class="products-grid">
                <div class="product-card">
                    <div class="product-icon">üå±</div>
                    <h3>Seeds & Seedlings</h3>
                    <p>High-quality palm oil seeds and seedlings for optimal plantation establishment</p>
                    <ul class="product-features">
                        <li>Certified seed varieties</li>
                        <li>Disease-resistant options</li>
                        <li>High-yield genetics</li>
                        <li>Quality assurance</li>
                    </ul>
                </div>

                <div class="product-card">
                    <div class="product-icon">üíß</div>
                    <h3>Fertilizers & Nutrients</h3>
                    <p>Specialized fertilizers and nutrients for different growth stages of palm trees</p>
                    <ul class="product-features">
                        <li>NPK formulations</li>
                        <li>Micronutrient supplements</li>
                        <li>Organic options</li>
                        <li>Stage-specific nutrients</li>
                    </ul>
                </div>

                <div class="product-card">
                    <div class="product-icon">üõ°Ô∏è</div>
                    <h3>Pesticides & Protection</h3>
                    <p>Effective pest control and plant protection solutions for healthy plantations</p>
                    <ul class="product-features">
                        <li>Integrated pest management</li>
                        <li>Eco-friendly options</li>
                        <li>Disease prevention</li>
                        <li>Targeted treatments</li>
                    </ul>
                </div>

                <div class="product-card">
                    <div class="product-icon">üîß</div>
                    <h3>Tools & Equipment</h3>
                    <p>Professional tools and equipment for efficient plantation management</p>
                    <ul class="product-features">
                        <li>Harvesting tools</li>
                        <li>Maintenance equipment</li>
                        <li>Safety gear</li>
                        <li>Measurement instruments</li>
                    </ul>
                </div>

                <div class="product-card">
                    <div class="product-icon">üì±</div>
                    <h3>Digital Solutions</h3>
                    <p>Smart technology solutions for modern plantation management</p>
                    <ul class="product-features">
                        <li>IoT sensors</li>
                        <li>Monitoring systems</li>
                        <li>Data analytics</li>
                        <li>Mobile applications</li>
                    </ul>
                </div>

                <div class="product-card">
                    <div class="product-icon">üë®‚Äçüéì</div>
                    <h3>Expert Consultation</h3>
                    <p>Professional agricultural consultation and expert guidance services</p>
                    <ul class="product-features">
                        <li>Agronomist consultation</li>
                        <li>Soil analysis</li>
                        <li>Yield optimization</li>
                        <li>Best practices training</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Chatbot Toggle Button -->
    <button class="chatbot-toggle" id="chatbotToggleButton" onclick="toggleChat()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
    </button>

    <!-- Chatbot Popup Container -->
    <div class="chatbot-container" id="chatbotContainer">
        <div class="chatbot-header">
            <div class="chatbot-title">
                <span>üå¥</span>
                <span>Palm Plantation Assistant</span>
            </div>
            <div class="chatbot-controls">
                <button class="chatbot-control-btn" onclick="toggleFullscreen()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                    </svg>
                </button>
                <button class="chatbot-control-btn" onclick="closeChat()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        </div>
        <div class="chatbot-messages" id="chatbotMessages">
            <div class="message bot">
                <div class="message-content">
                    Hello! I'm your AI palm plantation assistant. How can I help you with your plantation today?
                </div>
                <div class="sample-prompts">
                    <button class="sample-prompt" onclick="useSamplePrompt(this)">What's the best fertilizer for mature palm trees?</button>
                    <button class="sample-prompt" onclick="useSamplePrompt(this)">How to control pest infestations?</button>
                    <button class="sample-prompt" onclick="useSamplePrompt(this)">Recommend products for soil improvement</button>
                    <button class="sample-prompt" onclick="useSamplePrompt(this)">Best harvesting practices for maximum yield</button>
                </div>
            </div>
        </div>
        <div class="typing-indicator" id="typingIndicator">
            <span>Assistant is typing</span>
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatbotInput" placeholder="Ask about palm plantation..." onkeypress="handleChatInput(event)">
            <button class="send-btn" onclick="sendChatMessage()">Send</button>
        </div>
    </div>

    <!-- Footer -->
    <footer id="contact">
        <div class="footer-content">
            <div class="footer-links">
                <a href="#home">Home</a>
                <a href="#api-demo">API Demo</a>
                <a href="#products">Products</a>
                <a href="mailto:info@sawitpro.com">Contact</a>
            </div>
            <p>&copy; 2024 SawitPRO. All rights reserved. | TokoSawit Product Recommendation System</p>
        </div>
    </footer>

    <script>
        // Fallback responses when API fails
        const FALLBACK_RESPONSES = {
            "fertilizer": "For mature palm trees (5+ years), I recommend NPK 12-12-17 fertilizer with added magnesium. Apply 2kg per tree every 3 months. Our top products are: PalmPro NPK 12-12-17 (IDR 280,000/bag) and PalmMax Magnesium Plus (IDR 320,000/bag).",
            "pest": "For pest control, consider integrated pest management. For red palm mites, use miticides like Abamectin. For bagworms, use Bacillus thuringiensis. Our recommended products: BioMite Control (IDR 195,000/liter) and Organic PestGuard (IDR 225,000/liter).",
            "soil": "For soil improvement, use organic compost and maintain pH between 5.0-6.0. Apply 10-15kg of compost per tree annually. Recommended products: SoilPlus Organic Compost (IDR 150,000/bag) and pH Balance Formula (IDR 220,000/kg).",
            "harvest": "Best harvesting practices: 1) Harvest when 5-10 fruits drop naturally 2) Use a sickle with a long pole 3) Harvest every 7-10 days 4) Handle fruits gently to avoid bruising 5) Process within 24 hours of harvest.",
            "default": "I can help with palm plantation advice. Please ask about fertilizers, pest control, soil improvement, or harvesting practices."
        };

        let chatOpen = false;
        let isFullscreen = false;

        function toggleChat() {
            const chatbot = document.getElementById('chatbotContainer');
            const toggleButton = document.getElementById('chatbotToggleButton');
            chatOpen = !chatOpen;

            if (chatOpen) {
                chatbot.style.display = 'flex';
                toggleButton.style.display = 'none'; // Hide the button when chat is open
                document.getElementById('chatbotInput').focus();
            }
        }

        function closeChat() {
            const chatbot = document.getElementById('chatbotContainer');
            const toggleButton = document.getElementById('chatbotToggleButton');
            chatbot.style.display = 'none';
            toggleButton.style.display = 'flex'; // Show the button again when chat is closed
        }

        function toggleFullscreen() {
            const chatbot = document.getElementById('chatbotContainer');
            isFullscreen = !isFullscreen;

            if (isFullscreen) {
                chatbot.classList.add('fullscreen');
                document.body.style.overflow = 'hidden';
            } else {
                chatbot.classList.remove('fullscreen');
                document.body.style.overflow = '';
            }
        }

        function useSamplePrompt(button) {
            document.getElementById('chatbotInput').value = button.textContent;
            document.getElementById('chatbotInput').focus();
        }

        function handleChatInput(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        async function queryHuggingFace(prompt) {
            try {
                // Simulate API call
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve(getFallbackResponse(prompt));
                    }, 1000);
                });
            } catch (error) {
                console.error("Error calling HuggingFace API:", error);
                return getFallbackResponse(prompt);
            }
        }

        function getFallbackResponse(prompt) {
            const lowerPrompt = prompt.toLowerCase();

            if (lowerPrompt.includes('fertilizer') || lowerPrompt.includes('nutrient')) {
                return FALLBACK_RESPONSES.fertilizer;
            } else if (lowerPrompt.includes('pest') || lowerPrompt.includes('insect') || lowerPrompt.includes('mite')) {
                return FALLBACK_RESPONSES.pest;
            } else if (lowerPrompt.includes('soil') || lowerPrompt.includes('ph') || lowerPrompt.includes('compost')) {
                return FALLBACK_RESPONSES.soil;
            } else if (lowerPrompt.includes('harvest') || lowerPrompt.includes('fruit') || lowerPrompt.includes('yield')) {
                return FALLBACK_RESPONSES.harvest;
            } else {
                return FALLBACK_RESPONSES.default;
            }
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatbotInput');
            const message = input.value.trim();
            if (message === '') return;

            const messagesContainer = document.getElementById('chatbotMessages');

            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'message user';
            userMessage.innerHTML = `<div class="message-content">${message}</div>`;
            messagesContainer.appendChild(userMessage);

            // Clear input
            input.value = '';

            // Show typing indicator
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.style.display = 'flex';

            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            try {
                // Get response (will use fallback if API fails)
                const botResponse = await queryHuggingFace(message);

                // Hide typing indicator
                typingIndicator.style.display = 'none';

                // Add bot response
                const botMessage = document.createElement('div');
                botMessage.className = 'message bot';
                botMessage.innerHTML = `<div class="message-content">${botResponse}</div>`;
                messagesContainer.appendChild(botMessage);

            } catch (error) {
                typingIndicator.style.display = 'none';

                const errorMessage = document.createElement('div');
                errorMessage.className = 'message bot';
                errorMessage.innerHTML = `<div class="message-content">${FALLBACK_RESPONSES.default}</div>`;
                messagesContainer.appendChild(errorMessage);
            }

            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
    </script>
</body>
</html>

